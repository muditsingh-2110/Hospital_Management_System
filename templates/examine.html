<!-- filepath: c:\Users\Y N Singh\Desktop\SECL\templates\examine.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Examine Patient</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <h2>Examine Patient (UHID: {{ uhid }})</h2>
    <form method="post" id="prescriptionForm">
        <div class="mb-3">
            <label for="medicineSelect" class="form-label">Select Medicine</label>
            <select id="medicineSelect" class="form-select">
                <option value="">-- Select Medicine --</option>
                {% for med in medicines %}
                <option value="{{ med }}">{{ med }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="qtyInput" class="form-label">Quantity</label>
            <input type="number" id="qtyInput" class="form-control" min="1" value="1">
        </div>
        <button type="button" class="btn btn-primary mb-3" id="addMedicineBtn">Add Medicine</button>
        <h5>Prescription Table</h5>
        <table class="table table-bordered" id="prescriptionTable">
            <thead>
                <tr>
                    <th>Medicine</th>
                    <th>Quantity</th>
                    <th>Remove</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <input type="hidden" name="prescription" id="prescriptionInput">
        <button type="submit" class="btn btn-success">Submit Prescription</button>
    </form>
</div>
<script>
    let prescriptionList = [];
    function updateTable() {
        const tbody = $('#prescriptionTable tbody');
        tbody.empty();
        prescriptionList.forEach((item, idx) => {
            tbody.append(`<tr><td>${item.medicine}</td><td>${item.qty}</td><td><button type='button' class='btn btn-danger btn-sm' onclick='removeMed(${idx})'>Remove</button></td></tr>`);
        });
        $('#prescriptionInput').val(JSON.stringify(prescriptionList));
    }
    function removeMed(idx) {
        prescriptionList.splice(idx, 1);
        updateTable();
    }
    $(document).ready(function() {
        $('#addMedicineBtn').click(function() {
            const med = $('#medicineSelect').val();
            const qty = parseInt($('#qtyInput').val());
            if (!med || !qty || qty < 1) {
                alert('Please select a medicine and enter a valid quantity.');
                return;
            }
            prescriptionList.push({medicine: med, qty: qty});
            updateTable();
        });
        $('#prescriptionForm').submit(function() {
            if (prescriptionList.length === 0) {
                alert('Please add at least one medicine.');
                return false;
            }
            $('#prescriptionInput').val(JSON.stringify(prescriptionList));
            return true;
        });
    });
    window.removeMed = removeMed;
</script>
</body>
</html>